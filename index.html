<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitor DHT11</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #e5e7eb;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 {
  margin: 20px 0 10px;
}

button {
  margin: 10px;
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  background: #22c55e;
  font-size: 16px;
  cursor: pointer;
}

/* DASHBOARD */
.dashboard {
  display: flex;
  gap: 20px;
  max-width: 1100px;
  margin: auto;
  padding: 10px;
}

/* TARJETAS */
.card {
  background: var(--card);
  padding: 20px;
  border-radius: 15px;
  flex: 1;
  box-shadow: 0 0 20px #000;
}

.value {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 10px;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .dashboard {
    flex-direction: column;
  }

  .value {
    font-size: 26px;
  }

  button {
    width: 90%;
    max-width: 300px;
  }
}
</style>
</head>

<body>

<h1>üìä Monitor DHT11</h1>
<button onclick="connect()">üîå Conectar Arduino</button>

<div class="dashboard">

  <!-- TEMPERATURA -->
  <div class="card">
    <h2>üå°Ô∏è Temperatura</h2>
    <div class="value" id="tempValue">-- ¬∞C</div>
    <canvas id="tempChart"></canvas>
  </div>

  <!-- HUMEDAD -->
  <div class="card">
    <h2>üíß Humedad</h2>
    <div class="value" id="humValue">-- %</div>
    <canvas id="humChart"></canvas>
  </div>

</div>

<script>
let port, reader;
let tempChart, humChart;

const tempValue = document.getElementById("tempValue");
const humValue  = document.getElementById("humValue");

// GR√ÅFICO TEMPERATURA (NARANJA)
tempChart = new Chart(document.getElementById("tempChart"), {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Temperatura (¬∞C)",
      data: [],
      borderColor: "#f97316",
      backgroundColor: "rgba(249, 115, 22, 0.2)",
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false
  }
});

// GR√ÅFICO HUMEDAD (AZUL)
humChart = new Chart(document.getElementById("humChart"), {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Humedad (%)",
      data: [],
      borderColor: "#3b82f6",
      backgroundColor: "rgba(59, 130, 246, 0.2)",
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false
  }
});

// CONEXI√ìN SERIAL
async function connect() {
  port = await navigator.serial.requestPort();
  await port.open({ baudRate: 9600 });

  const decoder = new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  reader = decoder.readable.getReader();

  readSerial();
}

// LECTURA SERIAL
async function readSerial() {
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;

    const lines = value.trim().split("\n");

    lines.forEach(line => {
      const data = line.split(",");
      if (data.length === 2) {
        const temp = parseFloat(data[0]);
        const hum  = parseFloat(data[1]);

        // TEXTO
        tempValue.textContent = temp.toFixed(1) + " ¬∞C";
        humValue.textContent  = hum.toFixed(1) + " %";

        // GR√ÅFICOS
        tempChart.data.labels.push("");
        tempChart.data.datasets[0].data.push(temp);

        humChart.data.labels.push("");
        humChart.data.datasets[0].data.push(hum);

        if (tempChart.data.labels.length > 20) {
          tempChart.data.labels.shift();
          tempChart.data.datasets[0].data.shift();
          humChart.data.labels.shift();
          humChart.data.datasets[0].data.shift();
        }

        tempChart.update();
        humChart.update();
      }
    });
  }
}
</script>

</body>
</html>
