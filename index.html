<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitor DHT11</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  background: #0f172a;
  color: #e5e7eb;
  font-family: Arial, sans-serif;
  text-align: center;
}

h1 {
  margin-top: 20px;
}

button {
  margin: 15px;
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  background: #22c55e;
  font-size: 16px;
  cursor: pointer;
}

.dashboard {
  display: flex;
  justify-content: center;
  gap: 20px;
  max-width: 1000px;
  margin: auto;
}

.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 15px;
  width: 450px;
  box-shadow: 0 0 20px #000;
}

.value {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<h1>ğŸ“Š Monitor DHT11</h1>
<button onclick="connect()">ğŸ”Œ Conectar Arduino</button>

<div class="dashboard">

  <!-- TEMPERATURA -->
  <div class="card">
    <h2>ğŸŒ¡ï¸ Temperatura</h2>
    <div class="value" id="tempValue">-- Â°C</div>
    <canvas id="tempChart"></canvas>
  </div>

  <!-- HUMEDAD -->
  <div class="card">
    <h2>ğŸ’§ Humedad</h2>
    <div class="value" id="humValue">-- %</div>
    <canvas id="humChart"></canvas>
  </div>

</div>

<script>
let port, reader;
let tempChart, humChart;

const tempValue = document.getElementById("tempValue");
const humValue  = document.getElementById("humValue");

// GRÃFICO TEMPERATURA (NARANJA)
tempChart = new Chart(document.getElementById("tempChart"), {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Temperatura (Â°C)",
      data: [],
      borderColor: "#f97316",
      backgroundColor: "rgba(249, 115, 22, 0.2)",
      borderWidth: 2,
      tension: 0.4
    }]
  }
});

// GRÃFICO HUMEDAD (AZUL)
humChart = new Chart(document.getElementById("humChart"), {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Humedad (%)",
      data: [],
      borderColor: "#3b82f6",
      backgroundColor: "rgba(59, 130, 246, 0.2)",
      borderWidth: 2,
      tension: 0.4
    }]
  }
});

// CONEXIÃ“N SERIAL
async function connect() {
  port = await navigator.serial.requestPort();
  await port.open({ baudRate: 9600 });

  const decoder = new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  reader = decoder.readable.getReader();

  readSerial();
}

// LECTURA DE DATOS
async function readSerial() {
  while (true) {
    const { value, done } = await reader.read();
    if (done) break;

    const lines = value.trim().split("\n");

    lines.forEach(line => {
      const data = line.split(",");
      if (data.length === 2) {
        const temp = parseFloat(data[0]);
        const hum  = parseFloat(data[1]);

        // MOSTRAR TEXTO
        tempValue.textContent = temp.toFixed(1) + " Â°C";
        humValue.textContent  = hum.toFixed(1) + " %";

        // ACTUALIZAR GRÃFICOS
        tempChart.data.labels.push("");
        tempChart.data.datasets[0].data.push(temp);

        humChart.data.labels.push("");
        humChart.data.datasets[0].data.push(hum);

        if (tempChart.data.labels.length > 20) {
          tempChart.data.labels.shift();
          tempChart.data.datasets[0].data.shift();

          humChart.data.labels.shift();
          humChart.data.datasets[0].data.shift();
        }

        tempChart.update();
        humChart.update();
      }
    });
  }
}
</script>

</body>
</html>
